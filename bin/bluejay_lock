#!build/venv/bin/python

import os
import sys
import argparse
import logging
from bluejayhost import vault

logging.basicConfig(level=os.environ.get("LOGLEVEL", "DEBUG"))
logger = logging.getLogger("bluejayhost")

def run(*args):
    parser = argparse.ArgumentParser(description="Lock the vault")
    parser.add_argument("-i", "--input-path",
                        dest="input_path",
                        help="Path to the input git repo",
                        type=str,
                        default="/tmp/bluejay/vlt")
    parser.add_argument("-v", "--vault",
                        dest="vault_path",
                        help="Path to an output vault directory",
                        type=str,
                        required=True)
    args = parser.parse_args()
    logger.debug(f"Input repository: {args.input_path}")
    logger.debug(f"Output vault directory: {args.vault_path}")

    vlt = vault.VaultLock(
        os.path.abspath(args.input_path),
        os.path.abspath(args.vault_path))

    if not vlt.lock():
        print("Failed to lock the input repository")
    else:
        print("Successfully locked the input repository")

if __name__ == "__main__":
    run(sys.argv)
